/*!
 * THIS FILE IS GENERATED BY GULP PROJECT. 
 * NEVER CHANGE IT MANUALLY, OTHERWISE YOUR CHANGES 
 * CAN BE OVERWRITTEN. 
 * 
 * @description 
 * @repository git@bitbucket.org:ildar-meyker/html-barsgroup.git
 */

(function () {

	var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

	if (!iOS) return;

	function appendStyle(styles) {
	  var css = document.createElement('style');
	  css.type = 'text/css';

	  if (css.styleSheet) css.styleSheet.cssText = styles;
	  else css.appendChild(document.createTextNode(styles));

	  document.getElementsByTagName("head")[0].appendChild(css);
	}

	var styles = '* {cursor: pointer; }';

	window.onload = function() { appendStyle(styles) };

})();


var Overview = {

	_elems: {
		$_: $(),
		$bgItems: $(),
		$aboutItems: $(),
		$navItems: $(),
		$navBodies: $()
	},

	_state: {
		isUserActivityHandled: false,
		currIndex: 0
	},

	_startVideoLoading: function () {
		var self = this;

		self._elems.$_.find('video').each(function () {
			$(this)[0].load();
		});
	},

	_handleUserActivity: function (e) {
		var self = e.data.self;

		if ( self._state.isUserActivityHandled ) return;
		if ( !Modernizr.video || Modernizr.lowbandwidth ) return;

		self._state.isUserActivityHandled = true;
		setTimeout(self._startVideoLoading.bind(self), 100);
	},

	_handleCanPlayEvent: function (e) {
		var self = e.data.self;

		objectFitPolyfill(this);
		$(this).addClass('--active');
		$(this)[0].play();
	},

	_handleLinkClick: function (e) {
		var self = e.data.self;

		e.preventDefault();
		
		var nextIndex = $(this).closest('.overview__nav__item').index();
		var currIndex = self._state.currIndex;

		if (nextIndex == currIndex) return;

		// set active nav item
		self._elems.$navItems.eq(currIndex).removeClass('--active');
		self._elems.$navItems.eq(nextIndex).addClass('--active');

		// set active about item
		self._elems.$aboutItems.eq(currIndex).removeClass('--active');
		self._elems.$aboutItems.eq(nextIndex).addClass('--active');

		// collapse bodies
		self._elems.$navBodies.eq(currIndex).collapse('hide');
		self._elems.$navBodies.eq(nextIndex).collapse('show');

		// set active bg item
		if (nextIndex > currIndex) {
			// slide down
			var nextStartPos = -80;
			var currEndPos = 0;
		} else {
			// slide up
			var nextStartPos = 0;
			var currEndPos = -80;
		}

		self._elems.$bgItems.eq(nextIndex)
			.addClass('overview__bg__item--frozen')
			.css({
				transform: 'translateY(' + nextStartPos + 'px)',
				opacity: 0
			});

		setTimeout(function () {

			self._elems.$bgItems.eq(currIndex)
				.css({
					transform: 'translateY(' + currEndPos + 'px)',
					opacity: 0
				});

			self._elems.$bgItems.eq(nextIndex)
				.removeClass('overview__bg__item--frozen')
				.css({
					transform: 'translateY(-40px)',
					opacity: 1
				});

		}, 20);

		self._state.currIndex = nextIndex;
	},

	_bindUI: function () {
		var self = this;

		$('.overview__bg__video').on('canplaythrough', {self: self}, self._handleCanPlayEvent);
		self._elems.$_.on('click', '.overview__nav__link', {self: self}, self._handleLinkClick);
		$(document).one('click touchstart', {self: self}, self._handleUserActivity);
	},

	init: function () {
		var self = this;

		var $_ = $('#overview');

		if ( !$_.length ) return;

		self._elems.$_ = $_;
		self._elems.$bgItems = self._elems.$_.find('.overview__bg__item');
		self._elems.$aboutItems = self._elems.$_.find('.overview__about__item');
		self._elems.$navItems = self._elems.$_.find('.overview__nav__item');
		self._elems.$navBodies = self._elems.$_.find('.overview__nav__body');

		self._bindUI();

		$('body').trigger('click');
	}

};

var GanttSlider = {

	_cache: {
		gantt: {}
	},
	
	_elems: {
		$_: $(),
		$sandbox: $(),
		$inner: $(),
		$scroll: $(),
		$canvas: $(),
		$types: $(),
		$lines: $(),
		$items: $(),
		$ctrl: $(),
		$range: $(),
		$itemClone: $(),
		$typeClone: $()
	},

	_state: {
		isUserActivityHandled: false,
		currentView: 'gantt',
		groupedItems: [],
		randomItems: [],
		maxScrollLeft: 0,
		lastRangeValue: 0,
		lastScrollTop: 0,
		timeout: null
	},

	_getGanttPattern: function (width, height) {
		var self = this;

		// imagine, that we have some picture, which contains 7 rectangles.
		// pattern object properties describe how we can draw the picture
		var PATTERN = {
			canvasWidth: 2440,
			canvasHeight: 600,
			rectWidth: 510,
			rectHeight: 160,
			coords: [ [60, 310], [355, 25], [775, 200], [1070, 370], [1435, 100], [1760, 410], [2115, 120] ]
		};

		// items' width and height will change on different screen sizes
		// so we need to have a pattern suitable for new item's dimensions
		var result = {};
		result.canvasWidth = parseInt(PATTERN.canvasWidth / PATTERN.rectWidth * width);
		result.canvasHeight = parseInt(PATTERN.canvasHeight / PATTERN.rectHeight * height);
		result.coords = [];
		PATTERN.coords.forEach(function (coord) {
			result.coords.push([
				parseInt(coord[0] / PATTERN.canvasWidth * result.canvasWidth),
				parseInt(coord[1] / PATTERN.canvasHeight * result.canvasHeight)
			]);
		});

		return result;
	},

	// create elems clone to get their dimenstions
	_createElemsClones: function () {
		var self = this;

		var $itemClone = self._elems.$items.eq(0).clone();
		$itemClone.appendTo(self._elems.$sandbox);
		self._elems.$itemClone = $itemClone;

		var $typeClone = self._elems.$types.eq(0).clone();
		$typeClone.appendTo(self._elems.$sandbox);
		self._elems.$typeClone = $typeClone;
	},

	_sortItemsByGroup: function () {
		var self = this;

		var groupedItems = [];
		self._elems.$items.each(function (index, item) {
			var id = $(item).data('rel');
			if (typeof groupedItems[id] === 'undefined') groupedItems[id] = [];
			groupedItems[id].push(item);
		});
		self._state.groupedItems = groupedItems;
	},

	// picks items from different groups and puts them into one array
	_sortItemsRandomly: function () {
		var self = this;

		var totalCount = 0;
		var helperArray = [];
		self._state.groupedItems.forEach(function (items, index) {
			helperArray[index] = items.slice().reverse();
			totalCount += items.length;
		});

		var randomItems = [];
		var viewedCount = 0;
		while (viewedCount < totalCount) {
			helperArray.forEach(function (items) {
				if (items.length == 0) return;
				randomItems.push(items.pop())
				viewedCount++;
			});
		};

		self._state.randomItems = randomItems;
	},

	_getGanttViewCalcs: function () {
		var self = this;

		// get vars for cacheId
		var itemWidth = self._elems.$itemClone.outerWidth();
		var itemHeight = self._elems.$itemClone.outerHeight();

		var cacheId = itemWidth + 'x' + itemHeight;
		if ( !self._cache.gantt[cacheId] ) {

			var result = {
				canvas: {},
				items: []
			};

			// save items positions
			var pattern = self._getGanttPattern(itemWidth, itemHeight);
			var maxLeftPos = 0;

			self._state.randomItems.forEach(function (item, index) {
				var baseIndex = index % pattern.coords.length;
				var factor = Math.floor(index / pattern.coords.length);

				var leftPos = pattern.coords[baseIndex][0] + pattern.canvasWidth * factor;
				var topPos = pattern.coords[baseIndex][1];

				result.items[index] = {
					left: leftPos,
					top: topPos
				};

				if (leftPos > maxLeftPos) maxLeftPos = leftPos;
			});

			// save canvas size
			result.canvas.width = maxLeftPos + itemWidth + pattern.coords[0][0];
			result.canvas.height = pattern.canvasHeight;

			self._cache.gantt[cacheId] = result;
		}

		return self._cache.gantt[cacheId];
	},

	_switchToGanttView: function () {
		var self = this;

		self._elems.$_.addClass('gantt-slider--gantt-view');
		self._elems.$sandbox.addClass('gantt-slider--gantt-view');
		
		var calcs = self._getGanttViewCalcs();		

		// set items positions
		self._state.randomItems.forEach(function (item, index) {
			$(item).css({ 
				left: calcs.items[index].left, 
				top: calcs.items[index].top 
			});
		});

		// set canvas size
		self._elems.$canvas.css({
			width: calcs.canvas.width,
			height: calcs.canvas.height
		});


		self._state.currentView = 'gantt';
		self._updateScrollCalcs();
	},

	_switchToLinesView: function () {
		var self = this;

		self._elems.$_.removeClass('gantt-slider--gantt-view');
		self._elems.$sandbox.removeClass('gantt-slider--gantt-view');

		// inner offset
		var innerOffset = parseInt(self._elems.$inner.css('padding-left'));

		// get item dimentions
		var itemWidth = self._elems.$itemClone.outerWidth();
		var itemHeight = self._elems.$itemClone.outerHeight();
		var itemOffsetY = parseInt(self._elems.$itemClone.css('margin-bottom')); 
		var itemOffsetX = parseInt(self._elems.$itemClone.css('margin-right')); 

		// get type dimensions
		var typeWidth = self._elems.$typeClone.width();

		// get start pos
		var centerStart = self._elems.$ctrl.offset().left;

		var lineCounter = 0;
		var maxLeftPos = 0;
		var maxTopPos = 0;

		self._state.groupedItems.forEach(function (items, index) {
			var topPos = lineCounter * (itemHeight + itemOffsetY);

			// items
			items.forEach(function (item, index) {
				var leftPos = centerStart + typeWidth + index * (itemWidth + itemOffsetX);
				$(item).css({ top: topPos, left: leftPos });

				if (leftPos > maxLeftPos) maxLeftPos = leftPos;
			});

			// types
			self._elems.$types.filter('[data-rel="' + index + '"]').css({
				top: topPos,
				left: centerStart
			});

			// lines
			self._elems.$lines.filter('[data-rel="' + index + '"]').css({
				top: topPos,
				left: centerStart
			});

			if (topPos > maxTopPos) maxTopPos = topPos;
			lineCounter++;
		});

		// set lines size 
		self._elems.$lines.css({
			width: maxLeftPos + itemWidth - centerStart
		});

		// set canvas size
		self._elems.$canvas.css({
			width: maxLeftPos + itemWidth + innerOffset,
			height: maxTopPos + itemHeight + itemOffsetY
		});

		self._state.currentView = 'lines';
		self._updateScrollCalcs();
	},

	_updateScrollCalcs: function () {
		var self = this;

		// update maxScrollLeft
		var maxScrollLeft = self._elems.$canvas.width() - $(window).width();
		self._elems.$range.toggleClass('gantt-slider__range--hidden', maxScrollLeft < 0);
		self._state.maxScrollLeft = maxScrollLeft;

		// update handle position
		self._updateHandlePosition();
	},

	_updateHandlePosition: function () {
		var self = this;

		var scrollLeft = self._elems.$scroll.scrollLeft();
		var rangeValue = Math.round(1000 * scrollLeft / self._state.maxScrollLeft);
		self._elems.$range.find('input').val(rangeValue).change();
	},

	_initRangeSlider: function () {
		var self = this;

		var $rangeslider = $();

		self._elems.$range.find('input').rangeslider({
			polyfill: false,
			onInit: function () {
				$rangeslider = self._elems.$range.find('.rangeslider');
				$rangeslider.find('.rangeslider__handle').html('<i></i><i></i><i></i>');
			},
			onSlide: function(position, value) {
				if (value == self._state.lastRangeValue) return;
				self._state.lastRangeValue = value;
				
				var isHandleActive = $rangeslider.hasClass('rangeslider--active');
				if (!isHandleActive) return;

				var scrollLeft = self._state.maxScrollLeft / 1000 * value; 
				self._elems.$scroll.scrollLeft(scrollLeft);
			}
		});

	},


	_startVideoLoading: function () {
		var self = this;

		self._elems.$_.find('video').each(function () {
			$(this)[0].load();
		});
	},

	_handleWindowResize: function (e) {
		var self = e.data.self;

		switch (self._state.currentView) {
			case 'gantt': 
				self._switchToGanttView();
			break;
			case 'lines': 
				self._switchToLinesView();
			break;
		}
	},

	_handleToggleButton: function (e) {
		var self = e.data.self;

		e.preventDefault();

		switch (self._state.currentView) {
			case 'gantt': 
				self._switchToLinesView();
			break;
			case 'lines': 
				self._switchToGanttView();
			break;
		}
	},

	_handleUserActivity: function (e) {
		var self = e.data.self;

		if ( self._state.isUserActivityHandled ) return;
		if ( !Modernizr.video || Modernizr.lowbandwidth ) return;

		self._state.isUserActivityHandled = true;
		setTimeout(self._startVideoLoading.bind(self), 100);
	},

	_handleCanPlayEvent: function (e) {
		var self = e.data.self;

		objectFitPolyfill(this);
		$(this).addClass('--active');
	},

	_handleMouseOver: function (e) {
		var self = e.data.self;

		var $video = $(this).find('video.--active');
		if ($video.length) $video[0].play();
	},

	_handleMouseOut: function (e) {
		var self = e.data.self;

		var $video = $(this).find('video.--active');
		if ($video.length) $video[0].pause();
	},

	_handleSliderScroll: function (e) {
		var self = this;

		self._updateHandlePosition();
	},

	_handleWindowScroll: function (e) {
		var self = this;

		if (!Modernizr.requestanimationframe) return;
		if (!Modernizr.hiddenscroll) return;
		if (self._state.currentView != 'gantt') return;

		if (self._state.timeout) {
			window.cancelAnimationFrame(self._state.timeout);
		}

		self._state.timeout = window.requestAnimationFrame(function () {
			var scrollTop  = $(window).scrollTop();
			var delta  = self._state.lastScrollTop - scrollTop;
			scrollLeft = self._elems.$scroll.scrollLeft() - delta;
			self._elems.$scroll.scrollLeft(scrollLeft)
			self._state.lastScrollTop = scrollTop;
		});
	},

	_bindUI: function () {
		var self = this;

		self._elems.$_.find('video').on('canplaythrough', {self: self}, self._handleCanPlayEvent);
		self._elems.$_.on('mouseover', '.gantt-slider__item', {self: self}, self._handleMouseOver);
		self._elems.$_.on('mouseout', '.gantt-slider__item', {self: self}, self._handleMouseOut);
		self._elems.$_.on('click', '.gantt-slider__toggle', {self: self}, self._handleToggleButton);
		
		$(document).one('click touchstart', {self: self}, self._handleUserActivity);
		$(window).on('resize', {self: self}, self._handleWindowResize);

		self._elems.$scroll[0].addEventListener('scroll', self._handleSliderScroll.bind(self), false);
		window.addEventListener('scroll', self._handleWindowScroll.bind(self), false);
	},

	init: function () {
		var self = this;

		var $_ = $('#gantt-slider');
		if ( !$_.length ) return;
		
		self._elems.$_ = $_;
		self._elems.$sandbox = $('#gantt-slider-sandbox');
		self._elems.$inner = $_.find('.page__inner').first();
		self._elems.$scroll = $_.find('.gantt-slider__scroll');
		self._elems.$canvas = $_.find('.gantt-slider__canvas');
		self._elems.$types = $_.find('.gantt-slider__type');
		self._elems.$lines = $_.find('.gantt-slider__line');
		self._elems.$items = $_.find('.gantt-slider__item');
		self._elems.$ctrl = $_.find('.gantt-slider__ctrl');
		self._elems.$range = $_.find('.gantt-slider__range');

		self._createElemsClones();
		self._sortItemsByGroup();
		self._sortItemsRandomly();
		self._switchToGanttView();
		self._initRangeSlider();

		self._elems.$_.removeClass('gantt-slider--frozen --loading');

		self._bindUI();

		$('body').trigger('click');
	}

};

var CitiesSlider = {

	_cache: {
		gantt: {}
	},
	
	_elems: {
		$_: $(),
		$sandbox: $(),
		$scroll: $(),
		$canvas: $(),
		$items: $(),
		$ctrl: $(),
		$range: $(),
		$itemClone: $()
	},

	_state: {
		maxScrollLeft: 0,
		lastRangeValue: 0,
		lastZIndex: 50,
		lastScrollTop: 0,
		timeout: null
	},

	_getGanttPattern: function (width, height) {
		var self = this;

		// imagine, that we have some picture, which contains 7 rectangles.
		// pattern object properties describe how we can draw the picture
		var PATTERN = {
			canvasWidth: 2440,
			canvasHeight: 600,
			rectWidth: 510,
			rectHeight: 160,
			coords: [ [60, 310], [355, 25], [775, 200], [1070, 370], [1435, 100], [1760, 410], [2115, 120] ]
		};

		// items' width and height will change on different screen sizes
		// so we need to have a pattern suitable for new item's dimensions
		var result = {};
		result.canvasWidth = parseInt(PATTERN.canvasWidth / PATTERN.rectWidth * width);
		result.canvasHeight = parseInt(PATTERN.canvasHeight / PATTERN.rectHeight * height);
		result.coords = [];
		PATTERN.coords.forEach(function (coord) {
			result.coords.push([
				parseInt(coord[0] / PATTERN.canvasWidth * result.canvasWidth),
				parseInt(coord[1] / PATTERN.canvasHeight * result.canvasHeight)
			]);
		});

		return result;
	},

	// create elems clone to get their dimenstions
	_createElemsClones: function () {
		var self = this;

		var $itemClone = self._elems.$items.eq(0).clone();
		$itemClone.appendTo(self._elems.$sandbox);
		self._elems.$itemClone = $itemClone;
	},

	_getGanttViewCalcs: function () {
		var self = this;

		// get vars for cacheId
		var itemWidth  = self._elems.$itemClone.outerWidth();
		var itemHeight = self._elems.$itemClone.outerHeight();

		var cacheId = itemWidth + 'x' + itemHeight;
		if ( !self._cache.gantt[cacheId] ) {

			var result = {
				canvas: {},
				items: []
			};

			// save items positions
			var pattern = self._getGanttPattern(itemWidth, itemHeight);
			var maxLeftPos = 0;

			self._elems.$items.each(function (index, item) {
				var baseIndex = index % pattern.coords.length;
				var factor = Math.floor(index / pattern.coords.length);

				var leftPos = pattern.coords[baseIndex][0] + pattern.canvasWidth * factor;
				var topPos = pattern.coords[baseIndex][1];

				result.items[index] = {
					left: leftPos,
					top: topPos
				};

				if (leftPos > maxLeftPos) maxLeftPos = leftPos;
			});

			// save canvas size
			result.canvas.width = maxLeftPos + itemWidth + pattern.coords[0][0];
			result.canvas.height = pattern.canvasHeight;

			self._cache.gantt[cacheId] = result;
		}

		return self._cache.gantt[cacheId];
	},

	_setItemsPositions: function () {
		var self = this;
		
		var calcs = self._getGanttViewCalcs();		
		var canvasMiddle = calcs.canvas.height / 2;
		var itemHeight = self._elems.$itemClone.outerHeight();

		// set items positions
		self._elems.$items.each(function (index, item) {

			if ( calcs.items[index].top > canvasMiddle ) {
				$(item).css({ 
					left: calcs.items[index].left, 
					bottom: calcs.canvas.height - itemHeight - calcs.items[index].top,
					top: 'auto'
				});
			} else {
				$(item).css({ 
					left: calcs.items[index].left, 
					top: calcs.items[index].top,
					bottom: 'auto'
				});
			}

			
		});

		// set canvas size
		self._elems.$canvas.css({
			width: calcs.canvas.width,
			height: calcs.canvas.height
		});

		self._updateScrollCalcs();
	},

	_updateScrollCalcs: function () {
		var self = this;

		// update maxScrollLeft
		var maxScrollLeft = self._elems.$canvas.width() - $(window).width();
		self._elems.$range.toggleClass('cities-slider__range--hidden', maxScrollLeft < 0);
		self._state.maxScrollLeft = maxScrollLeft;

		// update handle position
		self._updateHandlePosition();
	},

	_updateHandlePosition: function () {
		var self = this;

		var scrollLeft = self._elems.$scroll.scrollLeft();
		var rangeValue = Math.round(1000 * scrollLeft / self._state.maxScrollLeft);
		self._elems.$range.find('input').val(rangeValue).change();
	},

	_initRangeSlider: function () {
		var self = this;

		var $rangeslider = $();

		self._elems.$range.find('input').rangeslider({
			polyfill: false,
			onInit: function () {
				$rangeslider = self._elems.$range.find('.rangeslider');
				$rangeslider.find('.rangeslider__handle').html('<i></i><i></i><i></i>');
			},
			onSlide: function(position, value) {
				if (value == self._state.lastRangeValue) return;
				self._state.lastRangeValue = value;
				
				var isHandleActive = $rangeslider.hasClass('rangeslider--active');
				if (!isHandleActive) return;

				var scrollLeft = self._state.maxScrollLeft / 1000 * value; 
				self._elems.$scroll.scrollLeft(scrollLeft);
			}
		});

	},

	_handleSliderScroll: function (e) {
		var self = this;

		self._updateHandlePosition();
	},

	_handleItemMouseenter: function (e) {
		var self = e.data.self;

		$(this).find('.cities-slider__item__collapse').stop().slideDown();
		$(this).css({ 'z-index': ++self._state.lastZIndex });
	},

	_handleItemMouseleave: function (e) {
		var self = e.data.self;

		$(this).find('.cities-slider__item__collapse').stop().slideUp();
	},

	_handleWindowResize: function (e) {
		var self = e.data.self;

		self._setItemsPositions();
	},

	_handleWindowScroll: function (e) {
		var self = this;

		if (!Modernizr.requestanimationframe) return;
		if (!Modernizr.hiddenscroll) return;

		if (self._state.timeout) {
			window.cancelAnimationFrame(self._state.timeout);
		}

		self._state.timeout = window.requestAnimationFrame(function () {
			var scrollTop  = $(window).scrollTop();
			var delta  = self._state.lastScrollTop - scrollTop;
			scrollLeft = self._elems.$scroll.scrollLeft() - delta;
			self._elems.$scroll.scrollLeft(scrollLeft)
			self._state.lastScrollTop = scrollTop;
		});
	},

	_bindUI: function () {
		var self = this;

		self._elems.$_.on('mouseenter', '.cities-slider__item', {self: self}, self._handleItemMouseenter);
		self._elems.$_.on('mouseleave', '.cities-slider__item', {self: self}, self._handleItemMouseleave);
		$(window).on('resize', {self: self}, self._handleWindowResize);

		self._elems.$scroll[0].addEventListener('scroll', self._handleSliderScroll.bind(self), false);
		window.addEventListener('scroll', self._handleWindowScroll.bind(self), false);
	},

	init: function () {
		var self = this;

		var $_ = $('#cities-slider');
		if ( !$_.length ) return;
		
		self._elems.$_ = $_;
		self._elems.$sandbox = $('#cities-slider-sandbox');
		self._elems.$scroll = $_.find('.cities-slider__scroll');
		self._elems.$canvas = $_.find('.cities-slider__canvas');
		self._elems.$items = $_.find('.cities-slider__item');
		self._elems.$ctrl = $_.find('.cities-slider__ctrl');
		self._elems.$range = $_.find('.cities-slider__range');

		self._createElemsClones();
		self._setItemsPositions();
		self._initRangeSlider();

		self._elems.$_.removeClass('cities-slider--frozen --loading');

		self._bindUI();
	}

};

var SliderContent = {

	_elems: {
		$_: $(),
		$wrapper: $(),
		$slider: $()
	},

	_handleWindowResize: function (e) {
		var self = e.data.self;

		self._elems.$slider.trigger('refresh.owl.carousel');
	},

	_handlePrevButton: function (e) {
		var self = e.data.self;

		e.preventDefault();

		self._elems.$slider.trigger('prev.owl.carousel')
	},

	_handleNextButton: function (e) {
		var self = e.data.self;

		e.preventDefault();

		self._elems.$slider.trigger('next.owl.carousel')
	},

	_bindUI: function () {
		var self = this;

		self._elems.$_.on('click', '.js-slider-content-prev', {self: self}, self._handlePrevButton);
		self._elems.$_.on('click', '.js-slider-content-next', {self: self}, self._handleNextButton);
		$(window).on('resize', {self: self}, self._handleWindowResize);
	},	

	init: function () {
		var self = this;

		var $_ = $('#slider-content');

		if ( !$_.length ) return;
		if ( $('body').hasClass('is-admin') ) return;

		self._elems.$_ = $_;
		self._elems.$wrapper = $_.find('.slider-content__wrapper');
		self._elems.$slider = $_.find('.owl-carousel');

		self._elems.$slider.owlCarousel({
		    items: 1,
		    dots: false
		});
		
		self._bindUI();
	}

};

var SliderDigits = {

	_state: {
		currentIndex: null,
		touchStartX: null,
		touchStartY: null,
		animating: false
	},

	_getRealIndex: function (index) {
		var self = this;

		return index % self._getRealCount(); 
	},

	_getNumsCount: function () {
		return $('#slider-digits .slider-digits__nums__item').length;
	},

	_getRealCount: function () {
		return $('#slider-digits .slider-digits__pics__item').length;
	},

	_getDirection: function (nextIndex) {
		var self = this;

		var currentIndex = self._state.currentIndex;
		return (nextIndex > currentIndex) ? 'left' : 'right';
	},

	_setInitialPosition: function () {
		var self = this;

		var count = self._getRealCount();

		self._state.currentIndex = count;
		self._moveNumsToItem(count);
	},

	_setRightRebasePos: function () {
		var self = this;

		var count = self._getRealCount();
		var nextIndex = self._state.currentIndex - count;

		self._state.currentIndex = nextIndex;
		self._moveNumsToItem(nextIndex);
	},

	_setVisibleState: function () {
		$('#slider-digits').addClass('_visible');
	},

	_setReadyState: function () {
		setTimeout(function () {
			$('#slider-digits').addClass('_ready');
		}, 20);
	},

	_cloneNumsItems: function () {
		var self = this;

		var $_ = $('#slider-digits');
		var $numsCrop = $_.find('.slider-digits__nums__crop');
		var $numsList = $_.find('.slider-digits__nums__list');
		var $numsItem = $_.find('.slider-digits__nums__item');
		var cropWidth = $numsCrop.width();
		var listWidth = $numsList.width();
		var factor = Math.ceil(cropWidth / listWidth) + 1;

		for (var i = 0; i < factor; i++) {
			$numsItem.clone().appendTo($numsList);
		}
	},

	_slideToItem: function (index) {
		var self = this;

		if ( self._state.animating ) return;
		self._state.animating = true;

		// indexes
		var currIndex = self._state.currentIndex;
		var nextIndex = index;

		// elements
		var $_ = $('#slider-digits');
		var $numsCrop = $_.find('.slider-digits__nums__crop');
		
		var $nextNumsItem = $_.find('.slider-digits__nums__item').eq(nextIndex);
		var $nextPicsItem = $_.find('.slider-digits__pics__item').eq(self._getRealIndex(nextIndex));
		var $nextTextItem = $_.find('.slider-digits__text__item').eq(self._getRealIndex(nextIndex));
		var $nextTextValue = $nextTextItem.find('.slider-digits__text__value');
		var $nextTextDesc = $nextTextItem.find('.slider-digits__text__desc');

		var $currNumsItem = $_.find('.slider-digits__nums__item').eq(currIndex);
		var $currPicsItem = $_.find('.slider-digits__pics__item').eq(self._getRealIndex(currIndex));
		var $currTextItem = $_.find('.slider-digits__text__item').eq(self._getRealIndex(currIndex));
		var $currTextValue = $currTextItem.find('.slider-digits__text__value');
		var $currTextDesc = $currTextItem.find('.slider-digits__text__desc');

		var $aboutItem = $_.find('.slider-digits__about__item');

		// direction
		var direction = self._getDirection(index);

		$aboutItem.eq(self._getRealIndex(currIndex)).removeClass('_active');
		
		setTimeout(function () {
			$aboutItem.eq(self._getRealIndex(nextIndex)).addClass('_active');
		}, 0);

		switch (direction) {
			case 'left': 

				// create fake copy of next num item
				var $fakeNumsItem = $nextNumsItem.clone();
				var position = $nextNumsItem.offset().left - $numsCrop.offset().left;
				$fakeNumsItem.addClass('_fixed').css({'left': position}).appendTo($numsCrop);
				$nextNumsItem.addClass('_hidden');

				// get the distance we will animate
				var distance = $fakeNumsItem.offset().left - $nextTextValue.offset().left;
				
				// set next text value to start position
				$nextTextValue.css({'transform': 'translateX(' + distance + 'px)'});

				// hide things
				$currTextDesc.addClass('_fadeOutLeft');
				$currTextValue.addClass('_fadeOutLeft');

				// show things
				setTimeout(function () {
					$nextPicsItem.addClass('_active _cover _fadeInImage');
					$nextTextDesc.addClass('_fadeInRight');
					$nextTextValue.addClass('_ready').css({'transform': 'translateX(0)'});
					$nextTextItem.addClass('_active');
					$fakeNumsItem.css({'transform': 'translateX(-' + distance + 'px)'});
					self._moveNumsToItem(nextIndex);
				}, 20);

			break;
			case 'right':

				// create fake copy of next num item
				var $fakeNumsItem = $currNumsItem.clone();
				var position = $currTextValue.offset().left - $numsCrop.offset().left;
				$fakeNumsItem.addClass('_fixed').css({'left': position}).appendTo($numsCrop);
				$currNumsItem.addClass('_hidden');

				// get the distance we will animate
				var distance = $numsCrop.offset().left - $currTextValue.offset().left + 
					parseFloat($currNumsItem.css('margin-left'));

				// hide things
				$currTextDesc.addClass('_fadeOutRight');
				$currTextValue.addClass('_ready').css({'transform': 'translateX(' + distance + 'px)'});
				$fakeNumsItem.css({'transform': 'translateX(' + distance + 'px)'});
				self._moveNumsToItem(nextIndex);

				// show things
				setTimeout(function () {
					$nextPicsItem.addClass('_active _cover _fadeInImage');
					$nextTextDesc.addClass('_fadeInLeft');
					$nextTextValue.addClass('_fadeInLeft');
					$nextTextItem.addClass('_active');
				}, 20);

			break;
		}

		setTimeout(function () {

			// clear transition classes
			$currPicsItem.removeClass('_active');
			$currTextItem.removeClass('_active');
			$currTextDesc.removeClass('_fadeOutLeft _fadeOutRight');
			$currTextValue.removeClass('_ready _fadeOutLeft').attr('style', '');
			$currNumsItem.removeClass('_hidden');

			$nextPicsItem.removeClass('_cover _fadeInImage');
			$nextTextDesc.removeClass('_fadeInRight _fadeInLeft');
			$nextTextValue.removeClass('_ready _fadeInLeft').attr('style', '');
			$nextNumsItem.removeClass('_hidden');
			
			$fakeNumsItem.remove();

			// allow animating
			self._state.animating = false;
			self._state.currentIndex = nextIndex;

			// rebase, if no side clones
			self._rebaseAtEdges();
		}, 700);

	},

	_moveNumsToItem: function (index) {
		var self = this;

		// сложить ширину и отступ всех элементов до текущего 
		var $items = $('#slider-digits .slider-digits__nums__item');
		var maxIndex = Math.min(index, self._getNumsCount() - 1);
		var listOffset = 0;

		for (var i = 0; i <= maxIndex; i++) {
			listOffset += parseFloat($items.eq(i).width());
			listOffset += parseFloat($items.eq(i).css('margin-left'));
		}
		
		var $list = $('#slider-digits .slider-digits__nums__list');
		$list.css({'transform': 'translateX(-' + listOffset + 'px)'});
	},

	_rebaseAtEdges: function () {
		var self = this;

		var $_ = $('#slider-digits');
		var $numsCrop = $_.find('.slider-digits__nums__crop');
		var $numsItem = $_.find('.slider-digits__nums__item');
		var penultOffset = $numsItem .last().prev().offset().left;
		var rightEdge = $numsCrop.offset().left + $numsCrop.width();
		var currIndex = self._state.currentIndex;

		if (currIndex == 0 || penultOffset < rightEdge) {
			$('#slider-digits').removeClass('_ready');

			if (currIndex == 0) {
				self._setInitialPosition();
			} else {
				self._setRightRebasePos();
			}
			setTimeout(function () {
				$('#slider-digits').addClass('_ready');
			}, 20);
		} 
	},

	_handleNumClick: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var nextIndex = $(this).index();
		self._slideToItem(nextIndex);
	},

	_handlePrevClick: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var nextIndex = self._state.currentIndex - 1;
		self._slideToItem(nextIndex);
	},

	_handleNextClick: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var nextIndex = self._state.currentIndex + 1;
		self._slideToItem(nextIndex);
	},

	_handleWindowResize: function (e) {
		var self = e.data.self;

		var currIndex = self._state.currentIndex;
		self._moveNumsToItem(currIndex);
	},

	_handleTouchStart: function (e) {
		var self = e.data.self;

		self._state.touchStartX = e.originalEvent.touches[0].clientX;
		self._state.touchStartY = e.originalEvent.touches[0].clientX;
	},

	_handleTouchMove: function (e) {
		var self = e.data.self;

		var touchStartX = self._state.touchStartX;
		var touchStartY = self._state.touchStartY;

		var deltaX = touchStartX - e.originalEvent.touches[0].clientX;
		var deltaY = touchStartY - e.originalEvent.touches[0].clientY;
		
		if (Math.abs(deltaX) > 100 && Math.abs(deltaX) > Math.abs(deltaY)) {
			if (deltaX > 0) {
				// swipe left
				var nextIndex = self._state.currentIndex + 1;
			} else {
				// swipe right
				var nextIndex = self._state.currentIndex - 1;
			}
			self._slideToItem(nextIndex);
		}
	},

	_bindUI: function () {
		var self = this;

		$(document).on('click', '.slider-digits__nums__item', {self: self}, self._handleNumClick);
		$(document).on('click', '#slider-digits .js-slider-digits-prev', {self: self}, self._handlePrevClick);
		$(document).on('click', '#slider-digits .js-slider-digits-next', {self: self}, self._handleNextClick);
		$(document).on('touchstart', '.slider-digits__center', {self: self}, self._handleTouchStart);
		$(document).on('touchmove', '.slider-digits__center', {self: self}, self._handleTouchMove);
		$(window).on('resize', {self: self}, self._handleWindowResize);
	},

	init: function () {
		var self = this;

		if ( $('#slider-digits').length == 0 ) return;

		self._cloneNumsItems();
		self._setInitialPosition();
		self._setVisibleState();
		self._setReadyState();

		self._bindUI();
	}

};


var SliderTabs = {

	_handleTabClick: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var $_ = $(this).closest('.slider-tabs');
		
		var currIndex = $_.find('.slider-tabs__ctrl__item._active').index();
		var nextIndex = $(this).index();

		if (nextIndex == currIndex) return;

		// set active nav item
		var $navItems = $_.find('.slider-tabs__ctrl__item');
		$navItems.eq(currIndex).removeClass('_active');
		$navItems.eq(nextIndex).addClass('_active');

		// set active bg item
		var $bgItems = $_.find('.slider-tabs__pics__item');
		if (nextIndex > currIndex) {
			// slide down
			var nextStartPos = -80;
			var currEndPos = 0;
		} else {
			// slide up
			var nextStartPos = 0;
			var currEndPos = -80;
		}

		$bgItems.eq(nextIndex).removeClass('_animate').css({
			transform: 'translateY(' + nextStartPos + 'px)',
			opacity: 0
		});

		setTimeout(function () {

			$bgItems.eq(currIndex).css({
				transform: 'translateY(' + currEndPos + 'px)',
				opacity: 0
			});

			$bgItems.eq(nextIndex).addClass('_animate').css({
				transform: 'translateY(-40px)',
				opacity: 1
			});

		}, 20);

	},

	_bindUI: function () {
		var self = this;

		$(document).on('click', '.slider-tabs__ctrl__item', {self: self}, self._handleTabClick);
	},

	init: function () {
		var self = this;

		self._bindUI();
	}

};

var Header = {


	_adjustMoreItem: function () {
		var self = this;

		var $_ = $('#header');

		// close dropdown during resizing
		var $more = $_.find('.header__menu__item--more');
		$more.removeClass('--opened');

		// compare container & items top offsets and find break point
		var $crop  = $_.find('.header__menu__crop');
		var cropOffset = $crop.offset().top;
		var $items = $crop.find('.header__menu__item');
		var lastIndex = 0;

		$items.each(function (index) {
			var itemOffset = $(this).offset().top;
			if (itemOffset == cropOffset) {
				lastIndex = index;
			}
		});

		// show 'more', if lastIndex less than maxIndex
		var $lastItem = $items.eq(lastIndex);
		var maxIndex = $items.length - 1;

		if (lastIndex < maxIndex) {

			// show 'more' and position it
			var lastItemLeft = $lastItem.offset().left - $crop.offset().left;
			var lastItemMargin = parseInt($lastItem.css('margin-right'));
			var lastItemWidth = $lastItem.width();

			var moreOffset = lastItemLeft + lastItemMargin + lastItemWidth;
			$more.addClass('--shown').css({ left: moreOffset + 'px'});

			// show/hide 'more' elements
			var $moreItems = $_.find('.header__menu__down__body > div');
			$moreItems.each(function (index) {
				if (index > lastIndex) {
					$(this).show();
				} else {
					$(this).hide();
				}
			});

		} else {
			$more.removeClass('--shown');
		}

	},

	_handleMoreClick: function (e) {
		var self = e.data.self;

		e.preventDefault();

		$('#header .header__menu__item--more').toggleClass('--opened');
	},

	_handleDocumentClick: function (e) {
		var self = e.data.self;

		var moreSelector = '.header__menu__item--more';
		if ( $(e.target).closest(moreSelector).length == 0 ){
			$('#header ' + moreSelector).removeClass('--opened');
		}
	},

	_handleWindowResize: function (e) {
		var self = e.data.self;

		self._adjustMoreItem();
	},

	_bindUI: function () {
		var self = this;

		$(document).on('click', {self: self}, self._handleDocumentClick);
		$(document).on('click', '.header__menu__item--more > a', {self: self}, self._handleMoreClick);
		$(window).on('resize', {self: self}, self._handleWindowResize);
	},

	init: function () {
		var self = this;

		if ( $('#header').length == 0) return;

		self._adjustMoreItem();
		self._bindUI();
	}
}

var News = {

	_elems: {
		$_: $(),
		$slider: $()
	},

	_handleNextButton: function (e) {
		var self = e.data.self;

		e.preventDefault();

		self._elems.$slider.trigger('next.owl.carousel');
	},

	_handlePrevButton: function (e) {
		var self = e.data.self;

		e.preventDefault();
		
		self._elems.$slider.trigger('prev.owl.carousel');
	},

	_handleChangedEvent: function (e) {
		var self = e.data.self;

		var activeClass = 'news__item--active';
		var nextIndex = e.item.index;

		self._elems.$slider.find('.news__item').removeClass(activeClass)
			.eq(nextIndex).addClass(activeClass);
	},

	_handleWindowResize: function (e) {
		var self = e.data.self;

		setTimeout(function () {
			self._elems.$slider.trigger('refresh.owl.carousel');
		}, 500);
	},

	_bindUI: function () {
		var self = this;

		self._elems.$_.on('click', '.js-news-next', {self: self}, self._handleNextButton);
		self._elems.$_.on('click', '.js-news-prev', {self: self}, self._handlePrevButton);
		self._elems.$_.on('changed.owl.carousel', {self: self}, self._handleChangedEvent);
		$(window).on('resize', {self: self}, self._handleWindowResize);
	},

	init: function () {
		var self = this;

		var $_ = $('#news');

		if ( !$_.length ) return;

		self._elems.$_ = $_;
		self._elems.$slider = $_.find('.news__list');

		self._bindUI();

		self._elems.$slider.owlCarousel({
		    loop: true,
		    autoWidth: true,
		    smartSpeed: 500
		});	
	}
};

var Form = {

	_handleFocusOnInput: function (e) {
		var self = e.data.self;

		$(this).parent().addClass('_focused');
	},

	_handleBlurOnInput: function (e) {
		var self = e.data.self;

		$(this).parent().removeClass('_focused');
	},

	_handleInputChange: function (e) {
		var self = e.data.self;

		$(this).parent().toggleClass('_filled', !!$(this).val().length);
	},

	_handleWingsMouseover: function (e) {
		var self = e.data.self;

		$(this).addClass('_hover');
	},

	_handleWingsMouseout: function (e) {
		var self = e.data.self;

		$(this).removeClass('_hover');
	},

	_handleFileChange: function (e) {
		var self = e.data.self;

		var files = $(this).find('input[type="file"]')[0].files;
		var names = $.map(files, function (file) {
			return file.name;
		});

		if ( names.length == 0 ) {
			$(this)
				.removeClass('_chosen');
		} else {
			$(this)
				.addClass('_chosen')
				.find('.js-form-file__names')
				.html(names.join(', '));
		}

	},

	_bindUI: function () {
		var self = this;

		$(document).on('focus', '.js-form-input', {self: self}, self._handleFocusOnInput);
		$(document).on('blur', '.js-form-input', {self: self}, self._handleBlurOnInput);
		$(document).on('change', '.js-form-input', {self: self}, self._handleInputChange);
		$(document).on('mouseover', '.js-form-wings', {self: self}, self._handleWingsMouseover);
		$(document).on('mouseout', '.js-form-wings', {self: self}, self._handleWingsMouseout);
		$(document).on('change', '.js-form-file', {self: self}, self._handleFileChange);
	},

	init: function () {
		var self = this;

		// init autosize
		autosize($('textarea'));

		// init checkboxes
		$('input').iCheck();

		self._bindUI();		
	}

};

(function () {

	$(document).ready(function() {

		$('.jsTTasksSlider').owlCarousel({
			items: 1,
			dots: false,
			nav: true,
			loop: true,
			navText: [''],
			navContainer: '.tTasks__nav'
		});

		$('.jsTIntroducedSlider').owlCarousel({
			items: 1,
			dots: false,
			nav: true,
			loop: true,
			navText: [''],
			navContainer: '.tIntroduced__nav'
		});

		$('.jsTComponentsSlider').owlCarousel({
			items: 1,
			dots: false,
			nav: true,
			loop: true,
			navText: [''],
			navContainer: '.tComponents__nav'
		});

	});

})();


var ScrollableTable = {
    init: function() {
        
        var initialOverflow = false;

        var scrollableTables = Array.prototype.slice.call(
            document.querySelectorAll(".js-news-details-content table")
        );

        function wrapTable(table) {
            
            var tableBlock = document.createElement("div");
            tableBlock.className = 'table-block';
            var tableGradientWrapper = document.createElement("div");
            tableGradientWrapper.className = 'table-gradient-wrapper js-srollable-table';
            var tableScrollContainer = document.createElement("div");
            tableScrollContainer.className = 'table-scroll-container js-scroll-container';
            var tablePreviousSibling = table.previousElementSibling;
            var tablePreviousSiblingType;
            
            table.parentNode.insertBefore(tableBlock, table);

            tableBlock.appendChild(tableGradientWrapper)
            tableGradientWrapper.appendChild(tableScrollContainer);
            tableScrollContainer.appendChild(table)

            if (tablePreviousSibling) {
                tablePreviousSiblingType = tablePreviousSibling.nodeName.toLowerCase();
                if (tablePreviousSiblingType === 'h1' ||  tablePreviousSiblingType === 'h2' ||  tablePreviousSiblingType === 'h3' ||  tablePreviousSiblingType === 'h4' ||  tablePreviousSiblingType === 'h5' ||  tablePreviousSiblingType === 'h6') {
                    tableBlock.insertBefore(tablePreviousSibling, tableGradientWrapper);
                }
            }

            return {
                tableGradientWrapper: tableGradientWrapper,
                tableScrollContainer: tableScrollContainer
            }
        }



        window.wrapTable = wrapTable;



        function addDragScrollHandlers(element) {
            var pressed = false;
            var startX;
            var scrollLeft;
            element.addEventListener("mousedown", function(event) {
                pressed = true;
                element.classList.add("active");
                startX = event.pageX - element.offsetLeft;
                scrollLeft = element.scrollLeft;
            });
            element.addEventListener("mouseleave", function() {
                pressed = false;
                element.classList.remove("active");
            });
            element.addEventListener("mouseup", function() {
                pressed = false;
                element.classList.remove("active");
            });
            element.addEventListener("mousemove", function(event) {
                if (!pressed) {
                    return;
                }
                event.preventDefault();
                var x = event.pageX - element.offsetLeft;
                var walk = x - startX;
                element.scrollLeft = scrollLeft - walk;
            });
        }

        scrollableTables.forEach(function(item) {

            var containers = wrapTable(item);
            var scrollableContainer = containers.tableScrollContainer
            var gradientWrapper = containers.tableGradientWrapper

            var handleGradientsOnStart = function() {
                if (
                    scrollableContainer.scrollWidth >
                    scrollableContainer.offsetWidth
                ) {
                    initialOverflow = true;
                    gradientWrapper.classList.add(
                        "table-gradient-wrapper--right-gradient"
                    );
                } else {
                    initialOverflow = false;
                    gradientWrapper.classList.remove(
                        "table-gradient-wrapper--right-gradient"
                    );
                }
            };

            var handleGradientsOnScroll = function() {
                var scrollLeft = this.scrollLeft;
                var scrollWidth = this.scrollWidth;
                var offsetWidth = this.offsetWidth;

                if (scrollLeft > 0 && scrollLeft < scrollWidth - offsetWidth) {
                    gradientWrapper.classList.add(
                        "table-gradient-wrapper--right-gradient"
                    );
                    gradientWrapper.classList.add(
                        "table-gradient-wrapper--left-gradient"
                    );
                } else if (scrollLeft === 0) {
                    gradientWrapper.classList.remove(
                        "table-gradient-wrapper--left-gradient"
                    );
                } else if (
                    scrollLeft > 0 &&
                    scrollLeft === scrollWidth - offsetWidth
                ) {
                    gradientWrapper.classList.remove(
                        "table-gradient-wrapper--right-gradient"
                    );
                }
            };

            if (scrollableContainer) {
                new PerfectScrollbar(scrollableContainer, {
                    maxScrollbarLength: 105
                });

                handleGradientsOnStart();

                addDragScrollHandlers(scrollableContainer);

                if (initialOverflow) {
                    scrollableContainer.addEventListener(
                        "scroll",
                        handleGradientsOnScroll
                    );
                }

                window.addEventListener("resize", function() {
                    scrollableContainer.removeEventListener(
                        "scroll",
                        handleGradientsOnScroll
                    );
                    handleGradientsOnStart();
                    if (initialOverflow) {
                        scrollableContainer.addEventListener(
                            "scroll",
                            handleGradientsOnScroll
                        );
                    }
                });
            }
        });
    }
};
var NewsSlider = {
    init: function() {
        var newsSliders = Array.prototype.slice.call(
            document.querySelectorAll(".js-news-slider")
        );

        newsSliders.forEach(function(item) {
           
            var sliderInstance = new Swiper(item, {
                slidesPerView: "auto",
                navigation: {
                    nextEl: document.querySelector(".js-news-slider--next"),
                    prevEl: document.querySelector(".js-news-slider--prev")
                },
                init: false
            });

            sliderInstance.init();
            
        });
    }
};
var NewsPhotoSlider = {
    init: function() {
        var photoSliders = Array.prototype.slice.call(
            document.querySelectorAll(".js-news-details-photo-slider")
        );


    
        photoSliders.forEach(function(item) {
            var thumbnails = item.querySelector(
                ".js-news-details-thumbnails-slider"
            );
            var container = item.querySelector(".swiper-container");
            var thumbContainer;
            if (thumbnails) {
                thumbContainer = thumbnails.querySelector(".swiper-container");
            }

            if (container && thumbContainer) {
                new Swiper(container, {
                    effect: "fade",
                    speed: 600,
                    fadeEffect: { crossFade: true },
                    navigation: {
                        nextEl: document.querySelector(
                            ".news-details__photo-slider-next"
                        ),
                        prevEl: document.querySelector(
                            ".news-details__photo-slider-prev"
                        )
                    },
                    thumbs: {
                        swiper: new Swiper(thumbContainer, {
                            slidesPerView: 9,
                            spaceBetween: 15,
                            threshold: 10,
                            // slideToClickedSlide: true,
                            watchSlidesVisibility: true,
                            watchSlidesProgress: true,
                            on: {
                                progress: function() {
                                    if (this.isBeginning) {
                                        thumbnails.classList.remove(
                                            "gradient-left"
                                        );
                                    } else if (this.isEnd) {
                                        thumbnails.classList.remove(
                                            "gradient-right"
                                        );
                                    } else {
                                        thumbnails.classList.add(
                                            "gradient-left"
                                        );
                                        thumbnails.classList.add(
                                            "gradient-right"
                                        );
                                    }
                                }
                            },
                            breakpoints: {
                                
                                460: {
                                    slidesPerView: 4,
                                    spaceBetween: 10,
                                },
                                
                                600: {
                                    slidesPerView: 6,
                                    spaceBetween: 10,
                                },
                                800: {
                                    slidesPerView: 7,
                                    spaceBetween: 15,
                                }
                            }
                        })
                    }
                });
            }
        });
    }
};
var NewsToggles = {
    init: function() {
        function setupHandlers(element) {
            if (element) {
                var elementContainer = element.parentElement;
                var elementContent = element.nextElementSibling;
                if (!elementContent)
                    throw new Error(
                        "Отсутствует блок контента виджета соседней новости"
                    );
                var elementOpen = false;
                function outsideClickHandler(event) {
                    if (
                        !elementContainer.contains(event.target) &&
                        event.target !== elementContainer
                    ) {
                        hideElement();
                    }
                }
                function openElement(event) {
                    if (event) event.preventDefault();
                    if (!elementOpen) {
                        elementContainer.classList.add("active");
                        elementOpen = true;
                        document.addEventListener("click", outsideClickHandler);
                        elementContent.addEventListener(
                            "mouseleave",
                            contentMouseLeaveHandler
                        );
                    }
                }
                function hideElement(event) {
                    if (event) event.preventDefault();
                    if (elementOpen) {
                        elementContainer.classList.remove("active");
                        elementOpen = false;
                        document.removeEventListener(
                            "click",
                            outsideClickHandler
                        );
                        elementContent.removeEventListener(
                            "mouseleave",
                            contentMouseLeaveHandler
                        );
                    }
                }

                function contentMouseLeaveHandler() {
                    hideElement();
                    // elementContent.removeEventListener(
                    //     "mouseleave",
                    //     contentMouseLeaveHandler
                    // );
                }

                element.addEventListener("click", openElement);
                element.addEventListener("mouseenter", function() {
                    openElement();
                    // elementContent.addEventListener(
                    //     "mouseleave",
                    //     contentMouseLeaveHandler
                    // );
                });
            }
        }

        setupHandlers(document.querySelector(".js-news-previous-article"));
        setupHandlers(document.querySelector(".js-news-next-article"));
    }
};

var NavBanner = {

	_handleItemClick: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var $root = $(this).closest('.nav-banner');

		// set line position
		var $line = $root.find('.nav-banner__line');
		var elemOffset = $(this).position().left;
		$line.css({left: elemOffset});

		// set active class
		$(this)
			.siblings().removeClass('_active')
			.end().addClass('_active');
	},

	_bindUI: function () {
		var self = this;

		$(document).on('click', '.nav-banner__item', {self: self}, self._handleItemClick);
	},

	init: function () {
		var self = this;

		self._bindUI();
	}
};

var TechPromo = {

	_state: {
		timers: []
	},

	_handleCanPlayEvent: function (e) {
		var self = e.data.self;

		objectFitPolyfill(this);
		$(this).addClass('--active');

		if ( $(this).closest('.tech-promo__figure__item').index() == 0 ) {
			$(this)[0].play();
		}
	},

	_setActiveVideo: function (index) {
		var self = this;

		var $items = $('#tech-promo .tech-promo__figure__item');
		$items.filter('.--active').removeClass('--active').end().find('video')[0].pause();
		$items.eq(index).addClass('--active').end().find('video')[0].play();
	},

	_handleCircleEnter: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var index = $(this).data('index');
		var circleId = $(this).data('circle-id');

		self._state.timers[circleId] = setTimeout(function () {
			self._setActiveVideo(index);
		}, 200);
	},

	_handleCircleLeave: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var circleId = $(this).data('circle-id');

		clearTimeout(self._state.timers[circleId]);
		self._setActiveVideo(0);
	},

	_bindUI: function () {
		var self = this;

		$('#tech-promo video').on('canplaythrough', {self: self}, self._handleCanPlayEvent);
		$('#tech-promo .tech-promo__circle').on('mouseenter', {self: self}, self._handleCircleEnter);
		$('#tech-promo .tech-promo__circle').on('mouseleave', {self: self}, self._handleCircleLeave);
	},

	init: function () {
		var self = this;

		var $_ = $('#tech-promo');

		if ( $_.length == 0) return;

		$_.find('.tech-promo__orbit').addClass('--active');

		setTimeout(function () {
			$_.find('.tech-promo__point').addClass('--active');
		}, 2000);

		setTimeout(function () {
			$_.find('.tech-promo__center').addClass('--active');
		}, 3700);

		setTimeout(function () {
			$_.find('.tech-promo__circle').addClass('--active');
		}, 4500);

		self._bindUI();
	}
}
var about = {
    /*** Init Function ***/
    init: function () {
        var self = this;

        self.variables();
        self.attachEvents();
    },
    /*** Variables ***/
    variables: function () {
        var self = this;

        /*** app ***/
        self.document = $(document);
        self.window   = $(window);
        self.body     = $('body');

        self.isMobile = false;
    },
    attachEvents: function(){
        var self = this;

        self.document.ready(function(){
            if(self.window.width() <= 576)
                self.isMobile = true;

            if(!self.isMobile) {
                AboutSlider.init();
            }

            if(self.isMobile)
                self.initGeo();
            else
                $('.iGeo__map img').on('load', function(){
                    self.initGeo();
                });

            if($('.iDigits-slides.owl-carousel') !== undefined && $('.iDigits-slides.owl-carousel').length)
                self.initDigits();

            if($('.iLeadership') !== undefined && $('.iLeadership').length)
                self.initLeadership();

            if($('.iHistory') !== undefined && $('.iHistory').length)
                self.initHistory();
        });

        self.window.resize(function(){
            if(self.window.width() <= 576)
                self.isMobile = true;
            else
                self.isMobile = false;
        });
    },
    initGeo: function(){
        var self = this;
        var offsetTop = self.isMobile ? 200 : 63;

        var height = $('.iGeo__map').height() + offsetTop;
        var width = $('.iGeo__map').width();
        $('.iGeo__items').width(!self.isMobile ? $('.iGeo__map img').width() : '100%');
        $('.iGeo__item').each(function(){
            var top = 0;
            var left = 0;
            if($(this).data('top') > 0)
                top = $(this).data('top') / height * 100;
            if($(this).data('left') > 0)
                left = $(this).data('left') / width * 100 + 0.75;

            if(self.isMobile)
                top = Math.max(0, top - 40);

            $(this).stop().animate({'top': top + '%', 'left': left + '%'}, 1000).addClass($('.iGeo__items').data('active'));
        });
    },
    initDigits: function(){
        var self = this;

        var owlDigits = $('.iDigits-slides.owl-carousel').owlCarousel({
            nav: false,
            dots: false,
            items: 1,
            auto: false,
            responsive: {
                568 : {
                    nav : true
                }
            }
        });

        owlDigits.on('changed.owl.carousel', function(event){
            $('.iDigits-values__item').removeClass($('.iDigits-values').data('active'));
            $('.iDigits-values__item').eq(event.item.index).addClass($('.iDigits-values').data('active'));
        });

        $('.iDigits-values__item').eq(0).addClass($('.iDigits-values').data('active'));

        $('.iDigits-values__item').click(function(){
            $('.iDigits-values__item').removeClass($('.iDigits-values').data('active'));

            $(this).addClass($('.iDigits-values').data('active'));

            var index = self.isMobile ? $(this).parent().index() : $(this).index();

            $('.iDigits .owl-carousel').trigger('to.owl.carousel', index);
        });

        if(self.isMobile && $('.iDigits-values.owl-carousel') !== undefined && $('.iDigits-values.owl-carousel').length){
            var owlDigitsValues = $('.iDigits-values.owl-carousel').owlCarousel({
                nav: false,
                dots: false,
                auto: false,
                autoWidth: true
            });
        }
    },
    initLeadership: function(){
        var self = this;

        if($('.iLeadership-item') === undefined || $('.iLeadership-item').length == 0)
            return;

        var height = $('.iLeadership-item').eq(0).height();
        $('.iLeadership-item').width(height*0.8);

        $('.iLeadership .button').click(function(event){
            event.preventDefault();

            if(self.isMobile) {
                if ($(this).hasClass('opened')) {
                    $('.iLeadership .page__center').removeClass('opened');
                    $(this).removeClass('opened').children('.button-default__text').text('Показать еще');
                    $(this).children('i').show();
                } else {
                    $('.iLeadership .page__center').addClass('opened');
                    $(this).addClass('opened').children('.button-default__text').text('Скрыть');
                    $(this).children('i').hide();
                }
            }
        });

        $("#leadershipModal").iziModal({
            overlayColor: 'rgba(0, 0, 0, 0.8)',
            width: 912,
            padding: 45,
            radius: 0,
            overlayClose: false,
            onOpening: function(event){
                var modal = event.$element;
                var left = modal.find('.iLeadership-modal__left');
                var right = modal.find('.iLeadership-modal__right');

                $.ajax({
                    url: 'data/leadership.json',
                    dataType: 'json',
                    beforeSend: function () {
                        modal.addClass('--loading');
                        left.empty();
                        right.empty();
                    },
                    success: function (data) {
                        setTimeout(function(){
                            modal.removeClass('--loading');
                        }, 500);

                        if(data.image)
                            left.append(
                                $('<img />')
                                    .attr('src', data.image)
                            );

                        if(data.name)
                            right.append(
                                $('<p/>')
                                    .addClass('iLeadership-modal__name')
                                    .text(data.name)
                            );

                        if(data.position)
                            right.append(
                                $('<p/>')
                                    .addClass('iLeadership-modal__position')
                                    .text(data.position)
                            );

                        if(data.content.length)
                            data.content.forEach(function (content) {
                                if (content.title)
                                    right.append(
                                        $('<p/>')
                                            .addClass('iLeadership-modal__title')
                                            .text(content.title)
                                    );
                                if (content.text)
                                    right.append(
                                        $('<div/>')
                                            .addClass('iLeadership-modal__text')
                                            .html(content.text)
                                    );
                            });
                    }
                })
            }
        });

        $('#leadershipModal .iziModal-close').click(function(event){
            event.preventDefault();

            $("#leadershipModal").iziModal('close');
        });

        $('.iLeadership-item').click(function(event){
            event.preventDefault();

            $('#leadershipModal').iziModal('open');
        });
    },
    initHistory: function(){
        var self = this;

        var ruler = $('.iHistory-ruler__line .owl-carousel');
        var events = $('.iHistory-events .owl-carousel');

        if(ruler === undefined || ruler.length == 0)
            return;
        if(events === undefined || events.length == 0)
            return;

        var owlRuler = ruler.owlCarousel({
            nav: false,
            dots: false,
            items: Math.min(14, ruler.data('count')),
            auto: false
        });

        var owlEvents = events.owlCarousel({
            nav: false,
            dots: false,
            items: 1,
            auto: false
        });

        $('.iHistory-ruler__item a').click(function(event){
            event.preventDefault();

            $('.iHistory-ruler__item').removeClass('iHistory-ruler__item--active');

            $(this).parent().addClass('iHistory-ruler__item--active');

            events.trigger('to.owl.carousel', $(this).parents('.owl-item').index() + 1);
        });
    }
};

if($('#about-slider') !== undefined && $('#about-slider').length)
    about.init();

var AboutSlider = {

    _GANTT_ITEM_WIDTH: 510,
    _GANTT_SCENE_HEIGHT: 600,
    _GANTT_EDGE_OFFSET: 60,

    _PATTERN_ITEMS: [[310, 60], [25, 355], [200, 775], [370, 1070], [100, 1435], [410, 1760], [120, 2115]],
    _PATTERN_WIDTH: 2440,

    _state: {
        randomItems: [],
        isUserActivityHandled: false,
        isGanttView: false,
        savedSceneHeight: null,
        maxScrollLeft: null,
        lastRangeValue: null
    },

    _initRangeSlider: function () {
        var self = this;

        var $range = $('#about-slider .gantt-slider__range');
        $range.data('position', 0);
        $range.find('input').rangeslider({
            polyfill: false,
            onInit: function () {
                $range.find('.rangeslider__handle').html('<i></i><i></i><i></i>');
            },
            onSlide: function(position, value) {
                if($('.iScroll').data('direction') == 'right'){
                    if(position < $range.data('position'))
                        $('.iScroll').data('direction', 'left');
                }
                else if($('.iScroll').data('direction') == 'left'){
                    if(position > $range.data('position'))
                        $('.iScroll').data('direction', 'right');
                }

                $range.data('position', position);

                self._state.maxScrollLeft = $('#about-slider .iScroll').width() - $('#about-slider .iScroll').width() / $('#about-slider .iScroll').children().length;
                var scrollLeft = self._state.maxScrollLeft / 1000 * value;
                $('#about-slider .gantt-slider__scroll').scrollLeft(scrollLeft);
            }
        });

    },

    _handleSliderScroll: function (e) {
        var self = e.data.self;

        var scrollLeft = $('#about-slider .gantt-slider__scroll').scrollLeft();
        self._state.maxScrollLeft = $('#about-slider .iScroll').width() - $('#about-slider .iScroll').width() / $('#about-slider .iScroll').children().length;
        var rangeValue = Math.round(1000 * scrollLeft / self._state.maxScrollLeft);
        $('#about-slider .gantt-slider__range input').val(rangeValue).change();

        var img = $('#wrapper .brand-box__image img');

        console.log($('.iScroll').data('direction'));

        $('.iScroll-item').each(function(){
            if(
                $('.iScroll').data('direction') == 'right' && $(this).offset().left >= 0 && $(this).offset().left < 360
                ||
                $('.iScroll').data('direction') == 'left' && $(this).width() + $(this).offset().left > 200 && $(this).width() + $(this).offset().left < 1600
            ){
                if($(this).find('.iScroll-item__label') !== undefined && $(this).find('.iScroll-item__label').length) {
                    $('#wrapper .page__label').text($(this).find('.iScroll-item__label').text());
                }
                else
                    $('#wrapper .page__label').text('О компании');

                if($(this).hasClass('iRatings')) {
                    img.attr('src', img.data('white'));
                    $(this).addClass('active');
                }
                else
                    img.attr('src', img.data('original'));
            }
        });
    },

    _bindUI: function () {
        var self = this;

        $('.gantt-slider__scroll').on('scroll', {self: self}, self._handleSliderScroll);
        $(window).on('resize orientationchange', {self: self}, self._handleWindowResize);
    },

    init: function () {
        var self = this;

        if ( $('#about-slider').length == 0 || $(window).width() <= 576) return;

        self._initRangeSlider();
        self._bindUI();

        $('html, body').mousewheel(function(e, delta) {
            var scrollLeft = $('#about-slider .gantt-slider__scroll').scrollLeft();
            scrollLeft     = scrollLeft - 150 * delta;
            console.log(delta);
            $('#about-slider .gantt-slider__scroll').stop().animate({scrollLeft: scrollLeft}, 100, 'easeOutQuint');
        });
    }
};

var NavMobile = {

	_state: {
		isOpened: false
	},

	_open: function () {
		var self = this;

		if (self._state.isOpened) return;

		$('body').addClass('page__locked');
		$('#nav-mobile').addClass('_active');

		self._state.isOpened = true;
	},

	_close: function () {
		var self = this;

		if (!self._state.isOpened) return;

		$('body').removeClass('page__locked');
		$('#nav-mobile').removeClass('_active');

		self._state.isOpened = false;
	},

	_handleOpenButton: function (e) {
		var self = e.data.self;

		e.preventDefault();

		self._open();
	},

	_handleCloseButton: function (e) {
		var self = e.data.self;

		e.preventDefault();

		self._close();
	},

	_handleMatchMedia: function (mql) {
		var self = this;

		if (!mql.matches) self._close();
	},

	_bindUI: function () {
		var self = this;

		$(document).on('click', '.js-nav-mobile-open', {self: self}, self._handleOpenButton);
		$(document).on('click', '.js-nav-mobile-close', {self: self}, self._handleCloseButton);
		window.matchMedia('(max-width: 950px)').addListener(self._handleMatchMedia.bind(self));
	},

	init: function () {
		var self = this;

		self._bindUI();
	}
}


var NavSticker = {

	_elems: {
		$_: $(),
		$static: $(),
		$fixed: $(),
		$lists: $(),
		$items: $()
	},

	_initOnePageNav: function () {
		var self = this;

		self._elems.$static.find('.nav-sticker__list').onePageNav({
			currentClass: '--active',
			scrollChange: function ($current) {
				var index = $current.index();
				self._setItemsActiveState(index);
			}
		});
	},

	_initMidnight: function () {
		var self = this;

		self._elems.$fixed.midnight();
	},

	_isItemInsideOfFixed: function ($item) {
		var self = this;

		return !!$item.closest('.midnightInner').length;
	},

	_setItemsActiveState: function (index) {
		var self = this;

		self._elems.$items.each(function () {
			$(this).toggleClass('--active', $(this).index() === index);
		});
	},

	_setNavsHiddenState: function () {
		var self = this;

		var scrollTop = $(window).scrollTop();
		var staticOffsetTop = self._elems.$static.offset().top;
		var isStaticHidden = staticOffsetTop - scrollTop < 40;
		var isFixedHidden = !isStaticHidden;

		self._elems.$static.toggleClass('--hidden', isStaticHidden);
		self._elems.$fixed.toggleClass('--hidden', isFixedHidden);
	},

	_handleWindowScroll: function () {
		var self = this;

		self._setNavsHiddenState();
	},

	_handleLinkClick: function (e) {
		var self = e.data.self;

		e.preventDefault();

		var index = $(this).parent().index();

		if ( self._isItemInsideOfFixed($(this)) ) {
			self._elems.$static
				.find('.nav-sticker__item').eq(index)
				.find('.nav-sticker__link').trigger('click');
		} else {
			self._setItemsActiveState(index);
		}
	},

	_handleListMouseEnter: function (e) {
		var self = e.data.self;

		self._elems.$_.addClass('--hover');
	},

	_handleListMouseLeave: function (e) {
		var self = e.data.self;

		self._elems.$_.removeClass('--hover');
	},

	_bindUI: function () {
		var self = this;

		$(document).on('mouseenter', '.nav-sticker__list', {self: self}, self._handleListMouseEnter);
		$(document).on('mouseleave', '.nav-sticker__list', {self: self}, self._handleListMouseLeave);
		$(document).on('click', '.nav-sticker__link', {self: self}, self._handleLinkClick);
		window.addEventListener('scroll', self._handleWindowScroll.bind(self), false);
	},

	init: function () {
		var self = this;

		var $_ = $('#nav-sticker');

		if ( $_.length == 0) return;

		self._elems.$_ = $_;
		self._elems.$static = $('#nav-sticker-static');
		self._elems.$fixed = $('#nav-sticker-fixed');

		// creates nav clones
		self._initMidnight();

		// save links after cloning & init for each nav
		self._elems.$lists = $_.find('.nav-sticker__list');
		self._elems.$items = $_.find('.nav-sticker__item');
		self._initOnePageNav();

		// show or hide
		self._setNavsHiddenState();

		self._bindUI();
	}

};
var App = {

	_elems: {
		$promoVideos: $()
	},

	_state: {
		preloaderTimer: null,
		promoVideosLoaded: 0,
		isWindowLoaded: false
	},

	_showContent: function () {
		var self = this;

		if ( self._state.isWindowLoaded === false ) return;
		if ( self._state.promoVideosLoaded !== self._elems.$promoVideos.length) return;

		clearInterval(self._state.preloaderTimer);

		$('#hello').removeClass('hello--active');
		$('body').removeClass('page__locked');
	},

	_handleDOMReady: function () {
		var self = this;

		// init modules here
		GanttSlider.init();
		CitiesSlider.init();
		SliderContent.init();
		SliderDigits.init();
		SliderTabs.init();
		Header.init();
		News.init();
		Form.init();
		ScrollableTable.init();
		NewsSlider.init();
		NewsPhotoSlider.init();
		NewsToggles.init();
		NavBanner.init();
		TechPromo.init();
		Overview.init();
		NavMobile.init();
		NavSticker.init();
	},

	_handleWindowLoad: function () {
		var self = this;

		self._state.isWindowLoaded = true;
	},

	_handleCanPlayEvent: function (e) {
		var self = e.data.self;

		self._state.promoVideosLoaded++;
	},

	_bindUI: function () {
		var self = this;

		self._elems.$promoVideos.on('canplaythrough', {self: self}, self._handleCanPlayEvent);
		$(window).on('load', self._handleWindowLoad.bind(self));
		$(self._handleDOMReady.bind(self));
	},

	init: function () {
		var self = this;

		// check promo videos
		self._elems.$promoVideos = $('video[data-promo]');

		// run preloader timer
		self._state.preloaderTimer = setInterval(self._showContent.bind(self), 50);

		self._bindUI();
	}
};

App.init();